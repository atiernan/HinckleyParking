<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="./img/launch.png">
        <meta name="theme-color" content="#ffffff">
        <link rel="manifest" href="./manifest.json">
        <link rel="apple-touch-icon" href="./img/launch.png">
        <title>Hinckley Parking</title>
    </head>
    <body style="margin: 0px;">
        <div>
            <canvas id="qr"></canvas>
            <button id="btnAdd" style="vertical-align:top;margin-top:10px;display:none">Add to home page</button>
        </div>
        <script src="./js/qrious.min.js"></script>
        <script src="./js/moment.js"></script>
        <script>
            // S001 P12 2018 12 27 17 55 08 A
            (function() {
                var code = "S001P12" + moment().add(1, 'hour').format('YYYYMMDDhhmmss') + "A";
                var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                var size = Math.min(w,h);
                var qr = new QRious({
                    element: document.getElementById('qr'),
                    value: code,
                    size: size,
                    level: "L"
                });
            })();

            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                btnAdd.style.display = 'block';
            });
            btnAdd.addEventListener('click', (e) => {
                btnAdd.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    deferredPrompt = null;
                });
            });
        </script>
    </body>
<html>